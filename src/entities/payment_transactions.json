
{
  "name": "payment_transactions",
  "options": {
    "validator": {
      "$jsonSchema": {
        "bsonType": "object",
        "required": ["user_id", "amount", "currency", "status", "transaction_type", "created_at"],
        "properties": {
          "user_id": {
            "bsonType": "string",
            "description": "User who made the payment"
          },
          "stripe_payment_intent_id": {
            "bsonType": "string",
            "description": "Stripe PaymentIntent ID"
          },
          "stripe_customer_id": {
            "bsonType": "string",
            "description": "Stripe Customer ID"
          },
          "amount": {
            "bsonType": "number",
            "minimum": 0,
            "description": "Payment amount in cents"
          },
          "currency": {
            "bsonType": "string",
            "description": "Payment currency (USD, EUR, etc.)"
          },
          "status": {
            "bsonType": "string",
            "enum": ["pending", "succeeded", "failed", "canceled", "refunded"],
            "description": "Payment status"
          },
          "transaction_type": {
            "bsonType": "string",
            "enum": ["subscription", "token_purchase", "upgrade"],
            "description": "Type of transaction"
          },
          "subscription_id": {
            "bsonType": "string",
            "description": "Related subscription ID"
          },
          "token_purchase_id": {
            "bsonType": "string",
            "description": "Related token purchase ID"
          },
          "coupon_code": {
            "bsonType": "string",
            "description": "Applied coupon code"
          },
          "metadata": {
            "bsonType": "object",
            "description": "Additional transaction metadata"
          },
          "created_at": {
            "bsonType": "string",
            "title": "datetime",
            "description": "Transaction creation time"
          },
          "updated_at": {
            "bsonType": "string",
            "title": "datetime",
            "description": "Last update time"
          }
        },
        "additionalProperties": true
      }
    },
    "validationLevel": "moderate",
    "validationAction": "warn"
  }
}
